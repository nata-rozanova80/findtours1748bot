# Hot Tours Parser Telegram Bot – CHECKLIST  
Версия: 1.0.1

---

## Репозиторий и структура проекта

- [ ] Репозиторий создан (GitHub/GitLab/локальный)
- [ ] В корне есть структура проекта:
  - [ ] `bot.py` – Telegram-бот, обработчики `/start`, `/promo`, `/about`, `/help`, `/update`, `/stats`, запуск приложения
  - [ ] `parser.py` – парсинг сайтов туроператоров (Tez Tour, 1001tur), функция `update_offers_from_all_sources()`
  - [ ] `db.py` – работа с SQLite (инициализация, сохранение, выборка, статистика)
  - [ ] `config.py` – загрузка настроек и переменных окружения из `.env`
  - [ ] `utils.py` – вспомогательные функции (например, настройка логирования)
  - [ ] `update_offers.py` – отдельный скрипт для ручного обновления базы
  - [ ] `requirements.txt` – список зависимостей
  - [ ] `README.md` – описание проекта и инструкции
  - [ ] `CHECKLIST.md` – текущий чек-лист
- [ ] Добавлен `.gitignore` (исключены `.env`, `venv/`, `*.db`, `*.log`, `__pycache__/` и т.п.)

---

## Требования и цели проекта

- [ ] Описана цель проекта: бот показывает до 10 актуальных «горящих туров» по `/promo`
- [ ] Определены целевые сайты (1–3 источника):
  - [ ] Tez Tour – акции/горящие туры
  - [ ] 1001tur – горячие туры/спецпредложения
- [ ] Зафиксированы минимальные требования:
  - [ ] Парсинг хотя бы 1 сайта
  - [ ] SQLite-хранилище `offers.db`
  - [ ] Команды `/start` и `/promo`
  - [ ] Выдача до 10 предложений из БД

---

## Окружение и зависимости (Local Dev)

- [ ] Установлен Python (3.10+ рекомендуется)
- [ ] Создано виртуальное окружение (`venv`)
- [ ] Установлены зависимости из `requirements.txt`:
  - [ ] `python-telegram-bot==20.8`
  - [ ] `requests`
  - [ ] `beautifulsoup4`
  - [ ] `python-dotenv`
  - [ ] (стандартный модуль `sqlite3`)
- [ ] Проект успешно запускается локально без ошибок импортов

---

## Конфигурация и секреты

- [ ] Создан файл `.env` (не в репозитории)
- [ ] В `.env` указаны:
  - [ ] `TELEGRAM_TOKEN=...` – токен бота от BotFather
  - [ ] (опционально) `DB_PATH=...` – путь к файлу базы данных
- [ ] В `config.py` реализована загрузка переменных окружения (`TELEGRAM_TOKEN`, `DB_PATH`)
- [ ] Проверено, что при отсутствии `.env` бот корректно сообщает об ошибке (или завершается с понятным логом)

---

## База данных SQLite

- [ ] Определена схема таблицы `offers` с полями:
  - [ ] `id INTEGER PRIMARY KEY AUTOINCREMENT`
  - [ ] `title TEXT NOT NULL`
  - [ ] `link TEXT NOT NULL`
  - [ ] `source TEXT`
  - [ ] `created_at DATETIME DEFAULT CURRENT_TIMESTAMP`
  - [ ] `UNIQUE(title, link)` для защиты от дублей
- [ ] Реализована функция `init_db()`
- [ ] Реализована функция `save_offers(offers: list[dict])`
- [ ] Реализована функция `get_last_offers(limit: int = 10)`
- [ ] Реализованы функции статистики (например, `get_offers_count()`, `get_sources_stats()`)
- [ ] Используется `INSERT OR IGNORE` или аналог, дубли по `title+link` не вызывают ошибок
- [ ] Файл `offers.db` добавлен в `.gitignore`

---

## Парсинг сайтов туроператоров

- [ ] В `parser.py` реализованы функции:
  - [ ] `get_offers_from_tez()`
  - [ ] `get_offers_from_1001tur()`
  - [ ] `update_offers_from_all_sources()`
- [ ] Для каждого сайта:
  - [ ] Определён URL страницы с акциями/горящими турами
  - [ ] Проанализирован HTML и выбраны устойчивые CSS-селекторы
  - [ ] Извлекаются как минимум `title` и `link` (при наличии – дополнительные поля)
- [ ] При сетевых ошибках (timeout, 4xx/5xx) парсер:
  - [ ] Логирует ошибку
  - [ ] Возвращает пустой список (не падает)
- [ ] При изменении верстки (0 найденных блоков):
  - [ ] Логируется предупредительное сообщение
- [ ] Все функции парсинга возвращают список словарей вида:
  - [ ] `{"title": ..., "link": ..., "source": ...}`

---

## Логика Telegram-бота

- [ ] В `bot.py` настроено подключение к Telegram через `python-telegram-bot`
- [ ] Реализованы команды:
  - [ ] `/start` – приветствие и краткое описание возможностей бота
  - [ ] `/promo` – выдача до 10 последних предложений из БД
  - [ ] `/about` – краткая информация о боте и источниках (Tez Tour, 1001tur)
  - [ ] `/help` – список команд и краткое описание
  - [ ] `/update` – ручной запуск обновления базы (вызов `update_offers_from_all_sources()`)
  - [ ] `/stats` – краткая статистика по количеству предложений
- [ ] Для `/promo`:
  - [ ] Используется `get_last_offers(limit=10)`
  - [ ] Формируется читаемый текст: нумерованный список, `title` + `link` (опционально `source`)
  - [ ] При отсутствии предложений выводится понятное сообщение
- [ ] Бот корректно обрабатывает исключения (ошибки не приводят к падению приложения)

---

## Интеграция парсера и бота

- [ ] Реализован сценарий обновления базы:
  - [ ] Через команду `/update` внутри бота, ИЛИ
  - [ ] Через отдельный скрипт `update_offers.py` для ручного запуска
- [ ] При обновлении:
  - [ ] Вызывается `update_offers_from_all_sources()`
  - [ ] Результаты парсинга передаются в `save_offers()`
- [ ] Проверено, что `/promo` показывает обновлённые данные после очередного запуска обновления

---

## Логирование и отладка

- [ ] Настроен модуль `logging` с единым форматом сообщений
- [ ] Логи пишутся в:
  - [ ] Консоль
  - [ ] (опционально) файл `bot.log`
- [ ] Логируются:
  - [ ] Старт/остановка бота
  - [ ] Запуск и результат парсинга (количество найденных предложений)
  - [ ] Ошибки HTTP и парсинга
  - [ ] Ошибки работы с БД
  - [ ] Ошибки Telegram API

---

## Документация и UX

- [ ] `README.md` содержит:
  - [ ] Описание проекта и его цели
  - [ ] Технологический стек
  - [ ] Архитектуру проекта (включая краткое описание файлов)
  - [ ] Схему БД
  - [ ] Инструкции по установке и запуску (локально и, при наличии, в проде)
  - [ ] Описание команд бота (`/start`, `/promo`, `/about`, `/help`, `/update`, `/stats`)
  - [ ] Формат сдачи проекта (для преподавателя/заказчика)
- [ ] `CHECKLIST.md` добавлен в репозиторий
- [ ] Оформлена краткая инструкция для проверки (можно прямо в README)

---

## Production / Деплой (опционально)

- [ ] Определена целевая среда (VPS, локальный сервер, Docker и т.п.)
- [ ] Установлена целевая ОС (например, Ubuntu 22.04 LTS)
- [ ] Установлен Python нужной версии
- [ ] Создан пользователь/директория для проекта (например, `/opt/hot-tours-bot`)
- [ ] Настроено виртуальное окружение и установлены зависимости
- [ ] Скопированы файлы проекта (без `.env`, создаётся отдельно)
- [ ] Создан и настроен `systemd`-unit (если используется systemd)
- [ ] Проверена автозагрузка бота после перезагрузки сервера

---

## Финальная проверка перед сдачей

- [ ] Бот запускается без ошибок
- [ ] `/start` работает и возвращает корректное приветствие
- [ ] `/promo` возвращает список из 1–10 предложений (при наличии данных в БД)
- [ ] При пустой БД бот корректно сообщает об этом
- [ ] Обновление предложений успешно выполняется (через `/update` или `update_offers.py`)
- [ ] README и CHECKLIST актуальны и соответствуют реализации
- [ ] Секреты (`.env`, токены, база) не попали в репозиторий
